#!/usr/bin/env bash
# Thin wrapper â€” delegates to the Python control plane (daylily_ec).
# The original Bash implementation is preserved at:
#   bin/legacy/daylily-create-ephemeral-cluster.bash
#
# Usage:
#   bin/daylily-create-ephemeral-cluster --region-az us-west-2b [OPTIONS]
set -euo pipefail

# Resolve repo root (directory containing this script's parent)
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
REPO_ROOT="$(cd "${SCRIPT_DIR}/.." && pwd)"

# Ensure we are in the repo root for config path resolution
cd "${REPO_ROOT}"

# Activate conda env if DAY-EC exists and is not already active
if command -v conda &>/dev/null; then
    CURRENT_ENV="${CONDA_DEFAULT_ENV:-}"
    if [ "${CURRENT_ENV}" != "DAY-EC" ]; then
        if conda info --envs 2>/dev/null | grep -q "^DAY-EC "; then
            eval "$(conda shell.bash hook 2>/dev/null)"
            conda activate DAY-EC
        fi
    fi
fi

exec python -m daylily_ec create "$@"

